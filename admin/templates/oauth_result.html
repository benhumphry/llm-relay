{% extends "base.html" %} {% block title %}Google Authentication{% endblock %}
{% block content %}
<div class="flex items-center justify-center min-h-[60vh]">
    <div class="card bg-base-100 shadow-xl max-w-md w-full">
        <div class="card-body text-center">
            {% if success %}
            <!-- Success State -->
            <div class="text-success mb-4">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-16 w-16 mx-auto"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                </svg>
            </div>
            <h2 class="card-title justify-center text-2xl">
                Connected Successfully
            </h2>
            <p class="text-base-content/70 mt-2">Google account connected:</p>
            <p class="font-mono text-sm bg-base-200 rounded-lg p-2 mt-2">
                {{ account_email }} {% if account_name %}
                <br /><span class="text-base-content/50"
                    >{{ account_name }}</span
                >
                {% endif %}
            </p>
            <p class="text-sm text-base-content/60 mt-4">
                You can now use this account as a document source.
            </p>
            <div class="card-actions justify-center mt-6">
                <a
                    href="{{ redirect_url or '/document-stores' }}"
                    class="btn btn-primary"
                >
                    Continue to Document Stores
                </a>
            </div>
            {% else %}
            <!-- Error State -->
            <div class="text-error mb-4">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-16 w-16 mx-auto"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                </svg>
            </div>
            <h2 class="card-title justify-center text-2xl">
                Authentication Failed
            </h2>
            <p class="text-error mt-2">{{ error }}</p>
            <div class="card-actions justify-center mt-6">
                <a href="/document-stores" class="btn btn-ghost">
                    Back to Document Stores
                </a>
                <button onclick="window.close()" class="btn btn-primary">
                    Close Window
                </button>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
    // Notify parent window if this was opened as a popup
    if (window.opener) {
        {% if success %}
        window.opener.postMessage({
            type: 'oauth_complete',
            success: true,
            provider: 'google',
            account_id: {{ account_id or 'null' }},
            account_email: '{{ account_email }}',
            account_name: '{{ account_name or "" }}'
        }, window.location.origin);

        // Auto-close after a short delay
        setTimeout(() => {
            window.close();
        }, 2000);
        {% else %}
        window.opener.postMessage({
            type: 'oauth_complete',
            success: false,
            provider: 'google',
            error: '{{ error | e }}'
        }, window.location.origin);
        {% endif %}
    }
</script>
{% endblock %}
